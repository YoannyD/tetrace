<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="project.open_view_project_all" model="ir.actions.act_window">
        <field name="context">{'search_default_estado_id': 1}</field>
        <field name="view_mode">kanban,tree,form,map</field>
    </record>

    <record model="ir.ui.view" id="view_project">
        <field name="name">project.project.tree.tetrace</field>
        <field name="inherit_id" ref="project.view_project"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="estado_id"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="edit_project">
        <field name="name">project.project.form.tetrace</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//header[1]" position="inside">
                <button class="oe_stat_button"
                        type="object"
                        name="action_activar_tareas"
                        string="Finalizar proyecto"/>

                <button class="oe_stat_button"
                        type="object"
                        name="action_crear_tareas_act_desc"
                        string="Crear tareas Activación/Desactivación"/>

                <field name="estado_id"
                       widget="statusbar"
                       options="{'clickable': '1'}"
                       groups="tetrace.group_tetrace_project_estado"/>
            </xpath>

            <xpath expr="//div[@name='button_box']/button" position="before">
                <button class="oe_stat_button"
                        type="object"
                        name="view_sale_order_form"
                        string="Presupuesto"
                        attrs="{'invisible':[('sale_order_id', '=', False)]}"
                        icon="fa-file-text-o"/>
            </xpath>

            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button"
                        type="object"
                        name="view_responsables_tree"
                        string="Responsables"
                        icon="fa-male"/>

                <button class="oe_stat_button"
                        type="object"
                        name="view_procesos_seleccion_tree"
                        string="Procesos de selección"
                        icon="fa-user-circle-o"/>

                <button class="oe_stat_button"
                        type="object"
                        name="action_gastos"
                        string="Gastos"
                        icon="fa-usd"/>

                <button class="oe_stat_button"
                        type="object"
                        name="action_ingresos"
                        string="Ingresos"
                        icon="fa-usd"/>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="partner_ids">
                    <tree editable="bottom">
                        <field name="name"/>
                    </tree>
                </field>
                <field name="maps" string ="Maps" widget="url"/>
                <field name="url_proyecto" widget="url"/>
                <field name="empresa_destino_nombre"/>
                <field name="cif_destino_nombre"/>
                <field name="direccion"/>
                <field name="nombre_parque"/>
            </xpath>

            <xpath expr="//field[@name='company_id']" position="after">
                <field name="fecha_inicio"/>
                <field name="fecha_cancelacion"/>
                <field name="fecha_finalizacion"/>
                <field name="motivo_cancelacion_id"
                       attrs="{'invisible': [('fecha_cancelacion', '=', False)], 'required': [('fecha_cancelacion', '!=', False)]}"/>
                <field name="resource_calendar_id" string="Calendario por defecto"/>
            </xpath>

            <xpath expr="//group[@name='misc'][1]" position="replace"/>

            <xpath expr="//page[@name='settings']" position="inside">
                <group>
                    <field name="descripcion"/>
                </group>
            </xpath>

            <xpath expr="//notebook[1]" position="inside">
                <page string="Técnicos">
                    <field name="tecnico_calendario_ids" context="{'default_resource_calendar_id': resource_calendar_id}" nolabel="1">
                        <tree editable="bottom">
                            <field name="employee_id"/>
                            <field name="resource_calendar_id"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="project_invoice_form_timesheet_tetrace">
        <field name="name">Inherit project form : Invoicing Data Tetrace</field>
        <field name="inherit_id" ref="hr_timesheet.project_invoice_form"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//div[@id='timesheet_settings']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="project_view_form_inherit_timesheet_tetrace">
        <field name="name">project.view.form.inherit.timesheet.tetrace</field>
        <field name="inherit_id" ref="sale_timesheet_enterprise.project_view_form_inherit"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='allow_timesheet_timer']/../.." position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//div[@id='allow_billable_container']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_project_kanban">
        <field name="name">project.project.kanban.tetrace</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('o_project_kanban_boxes')][1]/a[1]" position="before">
                <a style="width:0;" type="object" name="action_view_project"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="project_project_map_tetrace">
        <field name="name">project.project.map.tetrace</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <map res_partner="partner_geo_id">
                <marker-popup>
                    <field name="name" string="Proyecto"/>
                </marker-popup>
            </map>
        </field>
    </record>

    <record model="ir.ui.view" id="view_project_project_filter">
        <field name="name">project.project.select.tetrace</field>
        <field name="inherit_id" ref="project.view_project_project_filter"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//filter[1]" position="before">
                <filter string="Diseño"
                        name="filter_estado_id_diseno"
                        domain="[('estado_id', '=', 3)]"/>
                <filter string="En proceso"
                        name="filter_estado_id_en_proceso"
                        domain="[('estado_id', '=', 1)]"/>
                <filter string="Terminado"
                        name="filter_estado_id_terminado"
                        domain="[('estado_id', '=', 2)]"/>
                <filter string="Cancelado"
                        name="filter_estado_id_cancelado"
                        domain="[('estado_id', '=', 4)]"/>
                <separator/>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="estado_id"/>
            </xpath>

            <xpath expr="//group[1]" position="inside">
                <filter string="Estados" name="filter_estado_id" context="{'group_by': 'estado_id'}"/>
            </xpath>
        </field>
    </record>

    <record id="action_tetrace_project_state" model="ir.actions.act_window">
        <field name="name">Estados proyectos</field>
        <field name="res_model">tetrace.project_state</field>
        <field name="view_mode">tree,kanban,form</field>
    </record>

    <menuitem action="action_tetrace_project_state"
              id="menu_tetrace_project_state"
              name="Estados proyecto"
              parent="project.menu_project_config"
              sequence="7"/>

    <record model="ir.ui.view" id="project_project_state_form">
        <field name="name">tetrace.project_state.form</field>
        <field name="model">tetrace.project_state</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="project_project_state_tree">
        <field name="name">tetrace.project_state.tree</field>
        <field name="model">tetrace.project_state</field>
        <field name="arch" type="xml">
            <tree>
                <field name="sequence" widget="handle"/>
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_task_form2">
        <field name="name">project.task.form.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="department_id"/>
                <field name="info_puesto_id" attrs="{'invisible': [('department_laboral', '=', False)]}"/>
                <field name="department_laboral" invisible="1"/>
                <field name="job_id"/>
                <field name="employee_id" attrs="{'invisible': [('tarea_individual', '=', False)]}"/>
                <field name="tipo"/>
            </xpath>

            <xpath expr="//notebook[1]" position="inside">
                <page name="jobs" string="Procesos de selección" attrs="{'invisible': [('tarea_seleccion', '=', False)]}">
                    <field name="applicant_ids" nolabel="1"/>
                </page>

                <page name="entregas" string="Entregas" attrs="{'invisible': ['|', ('desde_plantilla', '=', True), ('producto_entrega', '=', False)]}">
                    <field name="producto_entrega" invisible="1"/>
                    <field name="desde_plantilla" invisible="1"/>
                    <field name="entrega_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha"/>
                            <field name="name"/>
                            <field name="entregado" sum="total"/>
                        </tree>
                    </field>
                </page>

                <page name="opciones" string="Opciones">
                    <group>
                        <group>
                            <field name="tarea_individual"/>
                            <field name="tarea_seleccion" attrs="{'invisible': [('tipo', '!=', 'activacion')]}"/>
                            <field name="viajes"/>
                            <field name="activada"/>
                            <field name="deadline_inicio"/>
                            <field name="deadline_fin"/>
                        </group>
                        <group>
                            <field name="opciones_desactivacion" widget="radio" attrs="{'invisible': [('tipo', '!=', 'desactivacion')]}"/>
                        </group>
                    </group>
                </page>

                <page name="viajes" string="Viajes" attrs="{'invisible': [('viajes', '=', False)]}">
                    <field name="viaje_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha"/>
                            <field name="origen"/>
                            <field name="destino"/>
                            <field name="contratado"/>
                            <field name="realizado"/>
                            <field name="employee_id"/>
                            <field name="observaciones"/>
                        </tree>
                        <form>
                            <group>
                                <group>
                                    <field name="fecha"/>
                                    <field name="origen"/>
                                    <field name="destino"/>
                                    <field name="contratado"/>
                                    <field name="realizado"/>
                                </group>
                                <group>
                                    <field name="employee_id"/>
                                    <field name="observaciones"/>
                                </group>
                            </group>
                        </form>
                    </field>
                </page>

                <page name="alquiler_vehiculos" string="Alquiler vehículos" attrs="{'invisible': [('viajes', '=', False)]}">
                    <field name="alquiler_vehiculo_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha_inicio"/>
                            <field name="fecha_fin"/>
                            <field name="recogida"/>
                            <field name="entrega"/>
                            <field name="completado"/>
                            <field name="realizado"/>
                            <field name="employee_id"/>
                            <field name="observaciones"/>
                        </tree>
                    </field>
                </page>

                <page name="alojamientos" string="Alojamientos" attrs="{'invisible': [('viajes', '=', False)]}">
                    <field name="alojamiento_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha"/>
                            <field name="ciudad"/>
                            <field name="completado"/>
                            <field name="realizado"/>
                            <field name="employee_id"/>
                            <field name="observaciones"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_task_tree2">
        <field name="name">project.task.tree.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="job_id"/>
                <field name="date_deadline"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_task_search_form">
        <field name="name">project.task.search.form.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='inactive']" position="after">
                <filter string="Desactivadas" name="no_activada" domain="[('activada', '=', False)]"/>
            </xpath>

            <xpath expr="//filter[@name='user']" position="after">
                <filter string="Empleados" name="filter_employee_id" context="{'group_by': 'employee_id'}"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="task_type_edit">
        <field name="name">project.task.type.form.tetrace</field>
        <field name="model">project.task.type</field>
        <field name="inherit_id" ref="project.task_type_edit"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='sequence']" position="after">
                <field name="bloquear_imputar_tiempos"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="task_type_tree">
        <field name="name">project.task.type.tree.tetrace</field>
        <field name="model">project.task.type</field>
        <field name="inherit_id" ref="project.task_type_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='fold']" position="after">
                <field name="bloquear_imputar_tiempos"/>
            </xpath>
        </field>
    </record>

    <record id="action_tetrace_motivo_cancelacion" model="ir.actions.act_window">
        <field name="name">Motivos cancelación</field>
        <field name="res_model">tetrace.motivo_cancelacion</field>
        <field name="view_mode">tree,kanban,form</field>
    </record>

    <menuitem action="action_tetrace_motivo_cancelacion"
              id="menu_tetrace_motivo_cancelacion"
              name="Motivos cancelación"
              parent="project.menu_project_config"
              sequence="8"/>

    <record model="ir.ui.view" id="tetrace_motivo_cancelacion_form">
        <field name="name">tetrace.motivo_cancelacion.form</field>
        <field name="model">tetrace.motivo_cancelacion</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="tetrace_motivo_cancelacion_tree">
        <field name="name">tetrace.motivo_cancelacion.form</field>
        <field name="model">tetrace.motivo_cancelacion</field>
        <field name="arch" type="xml">
            <tree>
                <field name="sequence" widget="handle"/>
                <field name="name"/>
            </tree>
        </field>
    </record>
</odoo>
