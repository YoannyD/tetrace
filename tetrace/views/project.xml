<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="project.open_view_project_all" model="ir.actions.act_window">
        <field name="context">{'search_default_estado_id': 1}</field>
        <field name="view_mode">kanban,tree,form,map</field>
    </record>

    <record model="ir.ui.view" id="view_project">
        <field name="name">project.project.tree.tetrace</field>
        <field name="inherit_id" ref="project.view_project"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="estado_id"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="edit_project">
        <field name="name">project.project.form.tetrace</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//header[1]" position="inside">
                <field name="estado_id" 
                       widget="statusbar" 
                       options="{'clickable': '1'}"
                       groups="tetrace.group_tetrace_project_estado"/>
            </xpath>
            
            <xpath expr="//div[@name='button_box']" position="inside">
                <button class="oe_stat_button" 
                        type="object" 
                        name="view_responsables_tree" 
                        string="Responsables"
                        icon="fa-male"/>
                
                <button class="oe_stat_button" 
                        type="object" 
                        name="view_tecnicos_tree" 
                        string="Técnicos"
                        icon="fa-users"/>
                
                <button class="oe_stat_button" 
                        type="object" 
                        name="view_procesos_seleccion_tree" 
                        string="Procesos de selección"
                        icon="fa-user-circle-o"/>
            </xpath>
            
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="partner_latitude"/>
                <field name="partner_longitude"/>
            </xpath>
            
            <xpath expr="//page[@name='settings']" position="inside">
                <group>
                    <field name="descripcion"/>
                </group>
            </xpath>
        </field>
    </record>
    
    <record model="ir.ui.view" id="view_project_kanban">
        <field name="name">project.project.kanban.tetrace</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('o_project_kanban_boxes')][1]/a[1]" position="before">
                <a style="width:0;" type="object" name="action_view_project"/>
            </xpath>
        </field>
    </record>
    
    <record model="ir.ui.view" id="project_project_map_tetrace">
        <field name="name">project.project.map.tetrace</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <map res_partner="partner_geo_id">
                <marker-popup>
                    <field name="name" string="Proyecto"/>
                </marker-popup>
            </map>
        </field>
    </record>

    <record model="ir.ui.view" id="view_project_project_filter">
        <field name="name">project.project.select.tetrace</field>
        <field name="inherit_id" ref="project.view_project_project_filter"/>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <xpath expr="//filter[1]" position="before">
                <filter string="Diseño" 
                        name="filter_estado_id_diseno" 
                        domain="[('estado_id', '=', 3)]"/>
                <filter string="En proceso" 
                        name="filter_estado_id_en_proceso" 
                        domain="[('estado_id', '=', 1)]"/>
                <filter string="Terminado" 
                        name="filter_estado_id_terminado" 
                        domain="[('estado_id', '=', 2)]"/>
                <filter string="Cancelado" 
                        name="filter_estado_id_cancelado" 
                        domain="[('estado_id', '=', 4)]"/>
                <separator/>
            </xpath>
            
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="estado_id"/>
            </xpath>

            <xpath expr="//group[1]" position="inside">
                <filter string="Estados" name="filter_estado_id" context="{'group_by': 'estado_id'}"/>
            </xpath>
        </field>
    </record>

    <record id="action_tetrace_project_state" model="ir.actions.act_window">
        <field name="name">Estados proyectos</field>
        <field name="res_model">tetrace.project_state</field>
        <field name="view_mode">tree,kanban,form</field>
    </record>

    <menuitem action="action_tetrace_project_state"
              id="menu_tetrace_project_state"
              name="Estados proyecto"
              parent="project.menu_project_config"
              sequence="7"/>

    <record model="ir.ui.view" id="project_project_state_form">
        <field name="name">tetrace.project_state.form</field>
        <field name="model">tetrace.project_state</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="project_project_state_tree">
        <field name="name">tetrace.project_state.tree</field>
        <field name="model">tetrace.project_state</field>
        <field name="arch" type="xml">
            <tree>
                <field name="sequence" widget="handle"/>
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_task_form2">
        <field name="name">project.task.form.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="job_id"/>
                <field name="tarea_seleccion"/>
            </xpath>
            
            <xpath expr="//notebook[1]" position="inside">
                <page name="contracts" string="Empleados" attrs="{'invisible': [('job_id', '=', False)]}">
                    <field name="contract_ids" nolabel="1"/>
                </page>
                
                <page name="jobs" string="Procesos de selección" attrs="{'invisible': [('job_id', '=', False)]}">
                    <field name="applicant_ids" nolabel="1"/>
                </page>
            </xpath>
        </field>
    </record>
    
    <record model="ir.ui.view" id="task_type_edit">
        <field name="name">project.task.type.form.tetrace</field>
        <field name="model">project.task.type</field>
        <field name="inherit_id" ref="project.task_type_edit"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='sequence']" position="after">
                <field name="bloquear_imputar_tiempos"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="task_type_tree">
        <field name="name">project.task.type.tree.tetrace</field>
        <field name="model">project.task.type</field>
        <field name="inherit_id" ref="project.task_type_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='fold']" position="after">
                <field name="bloquear_imputar_tiempos"/>
            </xpath>
        </field>
    </record>
</odoo>
