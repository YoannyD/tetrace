<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record model="ir.ui.view" id="view_task_form2">
        <field name="name">project.task.form.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="view_proyecto_necesidad_action" 
                        type="object" 
                        class="oe_stat_button" 
                        icon="fa-list" 
                        attrs="{'invisible' : [('busqueda_perfiles', '=', False)]}">
                    <field string="Necesidades" name="proyecto_necesidad_count" widget="statinfo"/>
                </button>
            </xpath>
            
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="department_id"/>
                <field name="info_puesto_id" attrs="{'invisible': [('department_laboral', '=', False)]}"/>
                <field name="department_laboral" invisible="1"/>
                <field name="job_id"/>
                <field name="employee_id" attrs="{'invisible': [('tarea_individual', '=', False)]}"/>
                <field name="tipo"/>
                <field name="ref_created" invisible="1"/>
            </xpath>

            <xpath expr="//notebook[1]" position="inside">
                <page name="entregas" string="Entregas" attrs="{'invisible': ['|', ('desde_plantilla', '=', True), ('producto_entrega', '=', False)]}">
                    <field name="producto_entrega" invisible="1"/>
                    <field name="desde_plantilla" invisible="1"/>
                    <field name="entrega_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha"/>
                            <field name="name"/>
                            <field name="entregado" sum="total"/>
                        </tree>
                    </field>
                </page>

                <page name="opciones" string="Opciones">
                    <group>
                        <group>
                            <field name="tarea_individual"/>
                            <field name="tarea_seleccion" attrs="{'invisible': [('tipo', '!=', 'activacion')]}"/>
                            <field name="viajes"/>
                            <field name="busqueda_perfiles"/>
                            <field name="ausencia"/>
                            <field name="activada"/>
                            <field name="deadline_inicio"/>
                            <field name="deadline_fin"/>
                        </group>
                        <group>
                            <field name="opciones_desactivacion" widget="radio" attrs="{'invisible': [('tipo', '!=', 'desactivacion')]}"/>
                        </group>
                    </group>
                </page>
                
                <page name="ausencias" string="Ausencias" attrs="{'invisible': [('ausencia', '=', False)]}">
                    <field name="ausencia_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="employee_id" required="1"/>
                            <field name="ausencia"/>
                            <field name="fecha_inicio"/>
                            <field name="fecha_fin"/>
                        </tree>
                    </field>
                </page>
                
                <page name="viajes" string="Viajes" attrs="{'invisible': [('viajes', '=', False)]}">
                    <field name="viaje_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha"/>
                            <field name="origen"/>
                            <field name="destino"/>
                            <field name="contratado"/>
                            <field name="realizado"/>
                            <field name="employee_id"/>
                            <field name="observaciones"/>
                        </tree>
                        <form>
                            <group>
                                <group>
                                    <field name="fecha"/>
                                    <field name="origen"/>
                                    <field name="destino"/>
                                    <field name="contratado"/>
                                    <field name="realizado"/>
                                </group>
                                <group>
                                    <field name="employee_id"/>
                                    <field name="observaciones"/>
                                </group>
                            </group>
                        </form>
                    </field>
                </page>

                <page name="alquiler_vehiculos" string="Alquiler vehÃ­culos" attrs="{'invisible': [('viajes', '=', False)]}">
                    <field name="alquiler_vehiculo_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha_inicio"/>
                            <field name="fecha_fin"/>
                            <field name="recogida"/>
                            <field name="entrega"/>
                            <field name="completado"/>
                            <field name="realizado"/>
                            <field name="employee_id"/>
                            <field name="observaciones"/>
                        </tree>
                    </field>
                </page>

                <page name="alojamientos" string="Alojamientos" attrs="{'invisible': [('viajes', '=', False)]}">
                    <field name="alojamiento_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="fecha"/>
                            <field name="fecha_fin"/>
                            <field name="ciudad"/>
                            <field name="completado"/>
                            <field name="realizado"/>
                            <field name="employee_id"/>
                            <field name="observaciones"/>
                        </tree>
                    </field>
                </page>
                
                <field name="project_id_sale_order_id" invisible="1"/>
                <page string="Asignaciones" attrs="{'invisible': [('project_id_sale_order_id', '!=', False)]}">
                    <field name="asginacion_ids" nolabel="1">
                        <tree editable="bottom">
                            <field name="company_id"/>
                            <field name="responsable_id"/>
                            <field name="seguidor_ids" widget="many2many_tags"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_task_tree2">
        <field name="name">project.task.tree.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_tree2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="job_id"/>
                <field name="employee_id"/>
                <field name="date_deadline"/>
                <field name="ref_created" invisible="1"/>
            </xpath>
        </field>
    </record>
    
    <record model="ir.ui.view" id="view_task_kanban">
        <field name="name">project.task.kanban.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="employee_id"/>
            </xpath>
            
            <xpath expr="//t[@t-if='record.partner_id.value']" position="before">
                <t t-if="record.employee_id.value">
                    <span>
                        Empleado: <field name="employee_id"/>
                    </span>
                </t>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_task_search_form">
        <field name="name">project.task.search.form.tetrace</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_search_form"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='inactive']" position="after">
                <filter string="Desactivadas" name="no_activada" domain="[('activada', '=', False)]"/>
            </xpath>

            <xpath expr="//filter[@name='user']" position="after">
                <filter string="Empleados" name="filter_employee_id" context="{'group_by': 'employee_id'}"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="task_type_edit">
        <field name="name">project.task.type.form.tetrace</field>
        <field name="model">project.task.type</field>
        <field name="inherit_id" ref="project.task_type_edit"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='sequence']" position="after">
                <field name="bloquear_imputar_tiempos"/>
                <field name="no_update_deadline"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="task_type_tree">
        <field name="name">project.task.type.tree.tetrace</field>
        <field name="model">project.task.type</field>
        <field name="inherit_id" ref="project.task_type_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='fold']" position="after">
                <field name="bloquear_imputar_tiempos"/>
                <field name="no_update_deadline"/>
            </xpath>
        </field>
    </record>
</odoo>
